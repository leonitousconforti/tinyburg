export const bitColors = [
    "FFFFFF",
    "000000",
    "333333",
    "666666",
    "999999",
    "CCCCCC",
    "CCCC99",
    "9999CC",
    "666699",
    "660000",
    "663300",
    "996633",
    "003300",
    "003333",
    "003399",
    "000066",
    "330066",
    "660099",
    "990000",
    "993300",
    "CC9900",
    "006600",
    "336666",
    "0033FF",
    "000099",
    "660099",
    "990066",
    "CC0000",
    "CC3300",
    "FFCC00",
    "009900",
    "006666",
    "0066FF",
    "0000CC",
    "663399",
    "CC0099",
    "FF0000",
    "FF3300",
    "FFFF00",
    "00CC00",
    "009999",
    "0099FF",
    "0000FF",
    "9900CC",
    "FF0099",
    "CC3333",
    "FF6600",
    "FFFF33",
    "00FF00",
    "00CCCC",
    "00CCFF",
    "3366FF",
    "9933FF",
    "FF00FF",
    "FF6666",
    "FF6633",
    "FFFF66",
    "66FF66",
    "66CCCC",
    "00FFFF",
    "3399FF",
    "9966FF",
    "FF66FF",
    "FF9999",
    "FF9966",
    "FFFF99",
    "99FF99",
    "66FFCC",
    "99FFFF",
    "66CCFF",
    "9999FF",
    "FF99FF",
    "FFCCCC",
    "FFCC99",
    "FFFFCC",
    "CCFFCC",
    "99FFCC",
    "CCFFFF",
    "99CCFF",
    "CCCCFF",
    "FFCCFF",
    "b86f4c",
    "ae5b33",
    "861912",
    "e39f94",
    "efb296",
    "b66e56",
    "f4c2aa",
    "efcfad",
    "7b5139",
    "a57152",
    "a57745",
    "f2a65e",
    "cd6c03",
    "fff6df",
    "926e5e",
    "6d382e",
];

export const skinColors = [
    "b86f4c",
    "ae5b33",
    "861912",
    "e39f94",
    "efb296",
    "b66e56",
    "f4c2aa",
    "efcfad",
    "7b5139",
    "a57152",
    "a57745",
    "f2a65e",
    "cd6c03",
    "fff6df",
    "926e5e",
    "6d382e",
];

export const bitImages = {
    skin: [{ img: "head" }],
    hair: [{ img: "hair0" }, { img: "hair1" }],
    glasses: [
        { img: null },
        { img: "glasses0", noColor: true },
        { img: "glasses1", noColor: true },
        { img: "glasses2", noColor: true },
    ],
    earrings: [{ img: null }, { img: "earrings" }],
    shirt: [{ img: "shirt" }],
    pants: [{ img: "pants" }],
    shoes: [{ img: "shoes" }],
    facialhair: [{ img: null }, { img: "hacc0" }, { img: "hacc1" }, { img: "hacc2" }],
    tie: [{ img: null }, { img: "tie" }],
    hat: [
        { img: null },
        { img: "bhat0" },
        { img: "bhat1" },
        { img: "bhat2" },
        { img: "bhat3" },
        { img: "bhat4" },
        { img: "bhat5" },
        { img: "bhat6" },
        { img: "bhat7" },
        { img: "bhat8" },
        { img: "bhat9" },
        { img: "bhat10" },
        { img: "bhat11" },
        { img: "bhat12" },
        { img: "bhat13" },
        { img: "bhat14" },
        { img: "bhat15" },
        { img: "bhat16" },
        { img: "fhat0" },
        { img: "fhat1" },
        { img: "mhat0" },
    ],
    costume: [
        { img: null },
        { img: "airline pilot", noColor: true },
        { img: "aloha", noColor: true },
        { img: "amigo", noColor: true },
        { img: "angel", noColor: true },
        { img: "apron", noColor: true },
        { img: "archaeologist", noColor: true },
        { img: "astronaut", noColor: true },
        { img: "banana", noColor: true },
        { img: "barber", noColor: true },
        { img: "barista", noColor: true },
        { img: "baseball uniform", noColor: true },
        { img: "bear", noColor: true },
        { img: "bee suit", noColor: true },
        { img: "bellhop", noColor: true },
        { img: "bikachu", noColor: true },
        { img: "biker", noColor: true },
        { img: "bitman", noColor: true },
        { img: "black dress", noColor: true },
        { img: "black ranger", noColor: true },
        { img: "blacksmith", noColor: true },
        { img: "blink", noColor: true },
        { img: "blue ranger", noColor: true },
        { img: "blue suit", noColor: true },
        { img: "boxer", noColor: true },
        { img: "bride", noColor: true },
        { img: "brown dress", noColor: true },
        { img: "bunny", noColor: true },
        { img: "burglar", noColor: true },
        { img: "business suit", noColor: true },
        { img: "captain bit", noColor: true },
        { img: "cat suit", noColor: true },
        { img: "caveman", noColor: true },
        { img: "cheerleader", noColor: true },
        { img: "chef", noColor: true },
        { img: "chicken", noColor: true },
        { img: "chinese suit", noColor: true },
        { img: "clown", noColor: true },
        { img: "export construction", noColor: true },
        { img: "convict", noColor: true },
        { img: "cossack", noColor: true },
        { img: "cowboy", noColor: true },
        { img: "creepy", noColor: true },
        { img: "cyborg", noColor: true },
        { img: "delivery", noColor: true },
        { img: "detective", noColor: true },
        { img: "devil", noColor: true },
        { img: "dinosaur", noColor: true },
        { img: "disco", noColor: true },
        { img: "diver", noColor: true },
        { img: "doctor", noColor: true },
        { img: "elephant", noColor: true },
        { img: "elf", noColor: true },
        { img: "elvis", noColor: true },
        { img: "engineer", noColor: true },
        { img: "eyepatch", noColor: true },
        { img: "fairy", noColor: true },
        { img: "farmer", noColor: true },
        { img: "fast food uniform", noColor: true },
        { img: "fez", noColor: true },
        { img: "fireman", noColor: true },
        { img: "fishing", noColor: true },
        { img: "football player", noColor: true },
        { img: "french maid", noColor: true },
        { img: "frog suit", noColor: true },
        { img: "gangster", noColor: true },
        { img: "gentleman", noColor: true },
        { img: "ghost", noColor: true },
        { img: "ghosthustler", noColor: true },
        { img: "g-man", noColor: true },
        { img: "gold dress", noColor: true },
        { img: "golfer", noColor: true },
        { img: "green ranger", noColor: true },
        { img: "groom", noColor: true },
        { img: "guard", noColor: true },
        { img: "hazmat", noColor: true },
        { img: "heart", noColor: true },
        { img: "hippie", noColor: true },
        { img: "horse", noColor: true },
        { img: "hotdog", noColor: true },
        { img: "hunter", noColor: true },
        { img: "ice queen", noColor: true },
        { img: "ironbit", noColor: true },
        { img: "jet helmet", noColor: true },
        { img: "karate outfit", noColor: true },
        { img: "king", noColor: true },
        { img: "knight", noColor: true },
        { img: "lab coat", noColor: true },
        { img: "lady", noColor: true },
        { img: "leather jacket", noColor: true },
        { img: "leprechaun", noColor: true },
        { img: "liberty", noColor: true },
        { img: "lumberjack", noColor: true },
        { img: "mad hatter", noColor: true },
        { img: "mad scientist", noColor: true },
        { img: "magician", noColor: true },
        { img: "maid", noColor: true },
        { img: "mapple genius", noColor: true },
        { img: "mime", noColor: true },
        { img: "monkey", noColor: true },
        { img: "monster suit", noColor: true },
        { img: "native american", noColor: true },
        { img: "nerd", noColor: true },
        { img: "ninja", noColor: true },
        { img: "nurse", noColor: true },
        { img: "overalls", noColor: true },
        { img: "panda hat", noColor: true },
        { img: "panda suit", noColor: true },
        { img: "paparazzi", noColor: true },
        { img: "phantom", noColor: true },
        { img: "pharaoh", noColor: true },
        { img: "piggy", noColor: true },
        { img: "pilgrim", noColor: true },
        { img: "pilot headset", noColor: true },
        { img: "pink ranger", noColor: true },
        { img: "pirate", noColor: true },
        { img: "plumber a", noColor: true },
        { img: "plumber b", noColor: true },
        { img: "princess", noColor: true },
        { img: "pumpkin", noColor: true },
        { img: "red baron", noColor: true },
        { img: "red dress", noColor: true },
        { img: "red hat", noColor: true },
        { img: "red ranger", noColor: true },
        { img: "red suit", noColor: true },
        { img: "robot", noColor: true },
        { img: "rockstar", noColor: true },
        { img: "roman", noColor: true },
        { img: "sailor", noColor: true },
        { img: "sanitation", noColor: true },
        { img: "santa", noColor: true },
        { img: "security", noColor: true },
        { img: "shark", noColor: true },
        { img: "snapdog", noColor: true },
        { img: "snowman", noColor: true },
        { img: "soccer", noColor: true },
        { img: "soldier", noColor: true },
        { img: "star captain", noColor: true },
        { img: "super hero", noColor: true },
        { img: "superbit", noColor: true },
        { img: "surgeon", noColor: true },
        { img: "swimmer", noColor: true },
        { img: "toga", noColor: true },
        { img: "tourist", noColor: true },
        { img: "travel agent", noColor: true },
        { img: "trooper", noColor: true },
        { img: "uncle sam", noColor: true },
        { img: "usher", noColor: true },
        { img: "vampire", noColor: true },
        { img: "viking", noColor: true },
        { img: "waiter", noColor: true },
        { img: "white suit", noColor: true },
        { img: "witch", noColor: true },
        { img: "yellow ranger", noColor: true },
        { img: "youngwizard", noColor: true },
        { img: "zombie", noColor: true },
    ],
};

export interface BitizenConfig {
    skin: { img: string; color: string };
    eyes: { img: string; color?: string };
    hair: { img: string; color: string };
    facialHair?: { img: string; color: string };
    glasses?: { img: string };
    shirt: { img: string; color: string };
    pants: { img: string; color: string };
    shoes: { img: string; color: string };
    hat?: { img: string; color: string };
    tie?: { img: string; color: string };
    earrings?: { img: string };
    costume?: { img: string };
    backgroundColor: string;
}

const BASE_URL = "http://bitbuilder.nimblebit.com/createImage.php";

/** Generates a bitbuilder URL for a given bitizen configuration */
export function generateBitizenUrl(config: Partial<BitizenConfig>): string {
    const params: string[] = [];

    if (config.skin) {
        params.push(`skin=${config.skin.img}`);
        params.push(`skinColor=${config.skin.color}`);
    }

    if (config.eyes) {
        params.push(`eyes=${config.eyes.img}`);
        // Eyes have noColor, so no color param needed
    }

    if (config.hair) {
        params.push(`hair=${config.hair.img}`);
        params.push(`hairColor=${config.hair.color}`);
    }

    if (config.facialhair?.img) {
        params.push(`facialhair=${config.facialhair.img}`);
        params.push(`facialhairColor=${config.facialhair.color}`);
    }

    if (config.glasses?.img) {
        params.push(`glasses=${config.glasses.img}`);
        // Glasses have noColor
    }

    if (config.shirt) {
        params.push(`shirt=${config.shirt.img}`);
        params.push(`shirtColor=${config.shirt.color}`);
    }

    if (config.pants) {
        params.push(`pants=${config.pants.img}`);
        params.push(`pantsColor=${config.pants.color}`);
    }

    if (config.shoes) {
        params.push(`shoes=${config.shoes.img}`);
        params.push(`shoesColor=${config.shoes.color}`);
    }

    if (config.hat?.img) {
        params.push(`hat=${config.hat.img}`);
        params.push(`hatColor=${config.hat.color}`);
    }

    if (config.tie?.img) {
        params.push(`tie=${config.tie.img}`);
        params.push(`tieColor=${config.tie.color}`);
    }

    if (config.earrings?.img) {
        params.push(`earrings=${config.earrings.img}`);
        // Earrings - check if it needs color
    }

    if (config.costume?.img) {
        params.push(`costume=${encodeURIComponent(config.costume.img)}`);
        // Costumes have noColor
    }

    if (config.backgroundColor) {
        params.push(`backgroundColor=${config.backgroundColor}`);
    }

    return `${BASE_URL}?${params.join("&")}`;
}

/** Get all hat image names (excluding null entries) */
export function getHatNames(): string[] {
    return bitImages.hat.filter((h) => h.img !== null).map((h) => h.img as string);
}

/** Get all costume image names (excluding null entries) */
export function getCostumeNames(): string[] {
    return bitImages.costume.filter((c) => c.img !== null).map((c) => c.img as string);
}

/** Get all facialhair image names (excluding null entries) */
export function getFacialhairNames(): string[] {
    return bitImages.facialhair.filter((f) => f.img !== null).map((f) => f.img as string);
}

/** Get all glasses image names (excluding null entries) */
export function getGlassesNames(): string[] {
    return bitImages.glasses.filter((g) => g.img !== null).map((g) => g.img as string);
}

/** Get all hair image names */
export function getHairNames(): string[] {
    return bitImages.hair.map((h) => h.img);
}

/**
 * Generator that yields all possible bitizen URL combinations Warning: This
 * generates an extremely large number of combinations!
 */
export function* generateAllCombinations(): Generator<string> {
    const hats = [null, ...getHatNames()];
    const costumes = [null, ...getCostumeNames()];
    const facialhairs = [null, ...getFacialhairNames()];
    const glasses = [null, ...getGlassesNames()];
    const hairs = getHairNames();

    // For a single representative combination per visual element (no color variations)
    const defaultColor = "666666";
    const defaultSkinColor = skinColors[0];
    const defaultBackgroundColor = "666289";

    for (const skinColor of skinColors) {
        for (const hair of hairs) {
            for (const hairColor of bitColors) {
                for (const facialhair of facialhairs) {
                    for (const glassesItem of glasses) {
                        for (const shirtColor of bitColors) {
                            for (const pantsColor of bitColors) {
                                for (const shoesColor of bitColors) {
                                    // Hat OR costume (mutually exclusive based on original logic)
                                    for (const hat of hats) {
                                        if (hat !== null) {
                                            for (const hatColor of bitColors) {
                                                yield generateBitizenUrl({
                                                    skin: { img: "head", color: skinColor },
                                                    eyes: { img: "eyes" },
                                                    hair: { img: hair, color: hairColor },
                                                    facialhair: facialhair
                                                        ? { img: facialhair, color: defaultColor }
                                                        : undefined,
                                                    glasses: glassesItem ? { img: glassesItem } : undefined,
                                                    shirt: { img: "shirt", color: shirtColor },
                                                    pants: { img: "pants", color: pantsColor },
                                                    shoes: { img: "shoes", color: shoesColor },
                                                    hat: { img: hat, color: hatColor },
                                                    backgroundColor: defaultBackgroundColor,
                                                });
                                            }
                                        }
                                    }

                                    for (const costume of costumes) {
                                        if (costume !== null) {
                                            yield generateBitizenUrl({
                                                skin: { img: "head", color: skinColor },
                                                eyes: { img: "eyes" },
                                                hair: { img: hair, color: hairColor },
                                                facialhair: facialhair
                                                    ? { img: facialhair, color: defaultColor }
                                                    : undefined,
                                                glasses: glassesItem ? { img: glassesItem } : undefined,
                                                shirt: { img: "shirt", color: shirtColor },
                                                pants: { img: "pants", color: pantsColor },
                                                shoes: { img: "shoes", color: shoesColor },
                                                costume: { img: costume },
                                                backgroundColor: defaultBackgroundColor,
                                            });
                                        }
                                    }

                                    // No hat and no costume
                                    yield generateBitizenUrl({
                                        skin: { img: "head", color: skinColor },
                                        eyes: { img: "eyes" },
                                        hair: { img: hair, color: hairColor },
                                        facialhair: facialhair ? { img: facialhair, color: defaultColor } : undefined,
                                        glasses: glassesItem ? { img: glassesItem } : undefined,
                                        shirt: { img: "shirt", color: shirtColor },
                                        pants: { img: "pants", color: pantsColor },
                                        shoes: { img: "shoes", color: shoesColor },
                                        backgroundColor: defaultBackgroundColor,
                                    });
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}

/** Generate a limited sample of URLs (for testing) */
export function generateSampleUrls(count: number = 100): string[] {
    const urls: string[] = [];
    const generator = generateAllCombinations();

    for (let i = 0; i < count; i++) {
        const result = generator.next();
        if (result.done) break;
        urls.push(result.value);
    }

    return urls;
}

/** Generate URL for a random bitizen */
export function generateRandomBitizenUrl(): string {
    const randomColor = () => bitColors[Math.floor(Math.random() * bitColors.length)];
    const randomSkinColor = () => skinColors[Math.floor(Math.random() * skinColors.length)];

    const hats = getHatNames();
    const costumes = getCostumeNames();
    const facialhairs = getFacialhairNames();
    const glasses = getGlassesNames();
    const hairs = getHairNames();

    const useHat = Math.random() > 0.5;
    const useCostume = !useHat && Math.random() > 0.5;
    const useFacialhair = Math.random() > 0.7;
    const useGlasses = Math.random() > 0.7;
    const useTie = Math.random() > 0.8;
    const useEarrings = Math.random() > 0.8;

    return generateBitizenUrl({
        skin: { img: "head", color: randomSkinColor() },
        eyes: { img: "eyes" },
        hair: { img: hairs[Math.floor(Math.random() * hairs.length)], color: randomColor() },
        facialhair: useFacialhair
            ? { img: facialhairs[Math.floor(Math.random() * facialhairs.length)], color: randomColor() }
            : undefined,
        glasses: useGlasses ? { img: glasses[Math.floor(Math.random() * glasses.length)] } : undefined,
        shirt: { img: "shirt", color: randomColor() },
        pants: { img: "pants", color: randomColor() },
        shoes: { img: "shoes", color: randomColor() },
        hat: useHat ? { img: hats[Math.floor(Math.random() * hats.length)], color: randomColor() } : undefined,
        tie: useTie ? { img: "tie", color: randomColor() } : undefined,
        earrings: useEarrings ? { img: "earrings" } : undefined,
        costume: useCostume ? { img: costumes[Math.floor(Math.random() * costumes.length)] } : undefined,
        backgroundColor: randomColor(),
    });
}

/** Calculate the total number of possible combinations */
export function calculateTotalCombinations(): bigint {
    const numSkinColors = BigInt(skinColors.length);
    const numBitColors = BigInt(bitColors.length);
    const numHairs = BigInt(bitImages.hair.length);
    const numFacialhairs = BigInt(bitImages.facialhair.length); // includes null
    const numGlasses = BigInt(bitImages.glasses.length); // includes null
    const numHats = BigInt(bitImages.hat.length); // includes null
    const numCostumes = BigInt(bitImages.costume.length); // includes null
    const numTies = BigInt(bitImages.tie.length); // includes null
    const numEarrings = BigInt(bitImages.earrings.length); // includes null

    // skin (fixed img) × skinColors × hair × hairColors × facialhair × facialhairColors ×
    // glasses × shirt × shirtColors × pants × pantsColors × shoes × shoesColors ×
    // (hat × hatColors + costumes + 1 for neither) × tie × tieColors × earrings × backgroundColors

    // This is a simplified calculation - actual number depends on mutual exclusivity rules
    const base =
        numSkinColors *
        numHairs *
        numBitColors * // hair color
        numFacialhairs *
        numGlasses *
        numBitColors * // shirt color
        numBitColors * // pants color
        numBitColors * // shoes color
        numTies *
        numEarrings *
        numBitColors; // background color

    // Hat/costume are mutually exclusive
    const hatCombinations = (numHats - 1n) * numBitColors; // hats with colors (excluding null)
    const costumeCombinations = numCostumes - 1n; // costumes (excluding null, no color)
    const neitherHatNorCostume = 1n;

    return base * (hatCombinations + costumeCombinations + neitherHatNorCostume);
}

// ============================================================================
// Original jQuery code from bitbuilder.nimblebit.com (commented out)
// ============================================================================

/*
var item = "hat";
var itemCount = 0;
var colorCount = 1;
var colorMax = 4;
var backgroundColor = "666289";
var categories = [
    "hats",
    "skin",
    "hair",
    "glasses",
    "earrings",
    "shirt",
    "pants",
    "shoes",
    "facialhair",
    "tie",
    "costumes",
    "background",
];
var categoryImages = {
    hats: { img: "category_hats.png", item: "hat" },
    glasses: { img: "category_glasses.png", item: "glasses" },
    earrings: { img: "category_earrings.png", item: "earrings" },
    facialhair: { img: "category_facialhair.png", item: "facialhair" },
    hair: { img: "category_hair.png", item: "hair" },
    pants: { img: "category_pants.png", item: "pants" },
    shirt: { img: "category_shirt.png", item: "shirt" },
    shoes: { img: "category_shoes.png", item: "shoes" },
    skin: { img: "category_skin.png", item: "skin" },
    tie: { img: "category_tie.png", item: "tie" },
    costumes: { img: "category_costumes.png", item: "costume" },
    background: { img: "category_background.png", item: "background" },
};

var bitizenCount = 0;
(function (a) {
    var b = function (b, c) {
        var d = a(b);
        var e = this;
        var f = a.extend({ param: "defaultValue" }, c || {});
        var g = 8;
        var h = 1;
        var i = 1;
        if (typeof c != "undefined" && typeof c["scale"] == "int") {
            g = c["scale"];
        }
        var j = 20;
        h = bitHeight * g;
        i = bitWidth * g;
        d.data("canvasH", h);
        d.data("canvasW", i);
        d.data("scale", g);
        d.data("bitizenCount", bitizenCount);
        bitizenCount++;
        d.height(h);
        d.width(i);
        var k = function (a) {
            var b = a.data();
            if (typeof b.details == "object") {
                if (b.details.img != null) {
                    if (b.type == "costume") {
                        b.img.src = "images/bitizen/costumes/" + b.details.img + ".png";
                    } else if (typeof b.details.noColor == "undefined") {
                        b.img.src = "colorize.php?image=bitizen-" + b.details.img + "&color=" + b.color;
                    } else {
                        b.img.src = "colorize.php?image=bitizen-" + b.details.img;
                    }
                    b.img.onload = function () {
                        b.context.drawImage(
                            b.img,
                            b.details.x * d.data("scale"),
                            b.details.y * d.data("scale"),
                            b.details.w * d.data("scale"),
                            b.details.h * d.data("scale")
                        );
                    };
                }
            }
        };
        var l = function (b, c, e) {
            img = new Image();
            d.append(
                '<canvas class="bitizen-canvas" style="z-index: ' +
                    j +
                    ';"  height="' +
                    d.data("canvasH") +
                    '" width="' +
                    d.data("canvasW") +
                    '" id="' +
                    b +
                    "-" +
                    d.data("bitizenCount") +
                    '"></canvas>'
            );
            j++;
            var f = document.getElementById(b + "-" + d.data("bitizenCount"));
            var g = f.getContext("2d");
            $canvas = a("#" + b + "-" + d.data("bitizenCount"));
            $canvas.data("details", c);
            $canvas.data("img", img);
            $canvas.data("context", g);
            $canvas.data("count", e);
            $canvas.data("type", b);
            var h;
            if (b == "skin") {
                h = skinColors[Math.floor(Math.random() * skinColors.length)];
            } else {
                h = bitColors[Math.floor(Math.random() * bitColors.length)];
            }
            $canvas.data("color", h);
            k($canvas);
        };
        for (var m = 0; m < bitLayers.length; m++) {
            if (typeof bitImages[bitLayers[m]] == "object") {
                rand = Math.floor(Math.random() * bitImages[bitLayers[m]].length);
                if (bitLayers[m] == "costume") rand = 0;
                img = bitImages[bitLayers[m]][rand];
                l(bitLayers[m], img, rand);
            }
        }
        var n = function (b) {
            var c = a("#" + b).data();
            if (c != null) {
                var d = c.context.createImageData(c.context.canvas.width, c.context.canvas.height);
                for (var e = d.data.length; --e >= 0; ) d.data[e] = 0;
                c.context.putImageData(d, 0, 0);
                c.img = new Image();
            }
        };
        this.getItem = function (a) {
            return a + "-" + d.data("bitizenCount");
        };
        this.getItemData = function (b) {
            return a("#" + b).data();
        };
        this.setItemData = function (b, c) {
            a("#" + b).data(c);
        };
        this.updateItem = function (b) {
            k(a("#" + b));
        };
        this.changeColor = function (b, c) {
            var d = a("#" + this.getItem(b)).data();
            if (d != null) {
                d.color = c;
                k(a("#" + this.getItem(b)));
            }
        };
        this.removeItem = function (b) {
            var c = a("#" + b).data();
            if (c != null) {
                n(b);
                c.details = bitImages[c.type][0];
                c.count = 0;
            }
        };
        this.nextItem = function (b) {
            var c = a("#" + b).data();
            if (c != null) {
                var d = c.count;
                if (c.type == "hat") this.removeItem(this.getItem("costume"));
                if (c.type == "costume") this.removeItem(this.getItem("hat"));
                var e = d + 1;
                if (bitImages[c.type].length == 1) {
                    e = 0;
                } else if (e > bitImages[c.type].length - 1) {
                    e = 0;
                    n(b);
                } else {
                    n(b);
                }
                c.details = bitImages[c.type][e];
                c.count = e;
                k(a("#" + b));
            }
        };
        this.preItem = function (b) {
            var c = a("#" + b).data();
            if (c != null) {
                var d = c.count;
                var e = d - 1;
                if (c.type == "hat") this.removeItem(this.getItem("costume"));
                if (c.type == "costume") this.removeItem(this.getItem("hat"));
                if (bitImages[c.type].length == 1) {
                    e = 0;
                } else if (e < 0) {
                    e = bitImages[c.type].length - 1;
                    n(b);
                } else {
                    n(b);
                }
                c.details = bitImages[c.type][e];
                c.count = e;
                k(a("#" + b));
            }
        };
        this.getBitizen = function () {
            var b = [];
            for (var c = 0; c < bitLayers.length; c++) {
                if (typeof bitImages[bitLayers[c]] == "object") {
                    $canvas = a("#" + bitLayers[c] + "-" + d.data("bitizenCount"));
                    data = $canvas.data();
                    var e = { img: data.details.img, color: data.color, type: data.type };
                    b.push(e);
                }
            }
            return b;
        };
    };
    a.fn.bitizen = function (c) {
        return this.each(function () {
            var d = a(this);
            if (d.data("bitizen")) return;
            var e = new b(this, c);
            d.data("bitizen", e);
        });
    };
})(jQuery);

$(document).ready(function () {
    var a;
    $("#bit").bitizen();
    a = $("#bit").data("bitizen");
    $("#stylePre").click(function () {
        if (item != "background") a.preItem(a.getItem(item));
        return false;
    });
    $("#styleNext").click(function () {
        if (item != "background") a.nextItem(a.getItem(item));
        return false;
    });
    $("#itemColor").click(function () {
        if (item != "glasses" && item != "costume") $("#colorPicker").show();
        return false;
    });
    $("#itemNext").click(function () {
        var a = itemCount + 1;
        if (a > categories.length - 1) {
            a = 0;
        }
        var b = categoryImages[categories[a]];
        item = b.item;
        itemCount = a;
        $("#itemTitle").html('<img src="images/' + b.img + '" />');
    });
    $("#itemPre").click(function () {
        var a = itemCount - 1;
        if (a < 0) {
            a = categories.length - 1;
        }
        var b = categoryImages[categories[a]];
        item = b.item;
        itemCount = a;
        $("#itemTitle").html('<img src="images/' + b.img + '" />');
    });
    $(".colorBox").click(function () {
        if (item != "background") {
            a.changeColor(item, this.rel);
        } else {
            console.log($(".bitizen-contain"));
            backgroundColor = this.rel;
            $(".bitizen-contain").css("background-color", "#" + this.rel);
        }
    });
    $(".colorClose").click(function () {
        $(".pickerPanel").hide();
        $("#colorPicker_1").show();
        $("#colorPicker").hide();
        colorCount = 1;
        return false;
    });
    $(".colorNext").click(function () {
        $("#colorPicker_" + colorCount).hide();
        var a = colorCount + 1;
        if (a > colorMax) {
            a = 1;
        }
        colorCount = a;
        $("#colorPicker_" + colorCount).show();
        return false;
    });
    $(".colorPre").click(function () {
        $("#colorPicker_" + colorCount).hide();
        var a = colorCount - 1;
        if (a <= 0) {
            a = colorMax;
        }
        colorCount = a;
        $("#colorPicker_" + colorCount).show();
        return false;
    });
    $("#bitShare img").click(function () {
        bitDetails = a.getBitizen();
        var b = "http://bitbuilder.nimblebit.com/createImage.php?";
        var c = true;
        for (var d = 0; d < bitDetails.length; d++) {
            if (!c) b = b + "&";
            c = false;
            b =
                b +
                bitDetails[d]["type"] +
                "=" +
                bitDetails[d]["img"] +
                "&" +
                bitDetails[d]["type"] +
                "Color=" +
                bitDetails[d]["color"];
        }
        b = b + "&backgroundColor=" + backgroundColor;
        window.location.href = b;
    });
});
*/
